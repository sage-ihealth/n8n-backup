{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "medrec.get_current_meds": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "medrec.create_medication_reconsiliation": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Walgreen_refill_obtain": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-13T18:05:31.533Z",
  "id": "NkJOG4K34YmLkO3z",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "AI Agent • MedRec Tools (n8n 1.120.1)",
  "nodes": [
    {
      "parameters": {
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        0,
        0
      ],
      "id": "6987c60a-bdf6-4bcc-9f52-c04aaaa5f670",
      "name": "When chat message received",
      "webhookId": "aef105f2-48d7-4f37-9cf4-26d05af90fea"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are a clinical medication reconciliation assistant. Your task is to help the patient complete their monthly medication reconciliation and then submit the final structured record using the reconciliation tool.\n\n======== WORKFLOW RULES ========\n\n1. First message to the patient:\n   - Greet the patient.\n   - Inform them it is time to complete their monthly medication reconciliation.\n   - Ask for their consent to begin.\n\n2. Only AFTER the patient agrees:\n   - Call the tool `medrec.get_current_meds` with the provided patient_id.\n   - Do NOT ask about medications before fetching the current list.\n\n3. After retrieving the medication list:\n   - Present a clear, friendly list of each medication including name, dose, frequency, route.\n   - For each medication, ask the patient:\n        “Are you still taking this medication as listed?”\n   - If any medication has changed:\n        - Ask what changed (dose, frequency, stopped, etc.).\n   - Ask if the patient is taking any additional medications not listed:\n        - Include prescription, OTC, supplements, vitamins, or herbal products.\n\n4. Build a final structured reconciliation summary including:\n   - reconfirmed medications\n   - updated medications\n   - discontinued medications\n   - newly reported medications\n   - global adherence summary (high / medium / low if you can infer it)\n   - any relevant notes\n\n5. When the reconciliation is complete:\n   - Call the tool `medrec.create_medication_reconsiliation` and submit:\n        - patient_id\n        - reconciliation_datetime (ISO timestamp)\n        - performed_by (clinician or AI assistant if needed)\n        - medications array with reconciliation_status per item:\n              • confirmed\n              • updated\n              • removed\n              • new\n        - global_adherence_summary\n        - session_payload.autosaveNote for draft notes\n\n6. After submitting:\n   - Confirm to the patient that the reconciliation has been successfully recorded.\n\n======== BEHAVIOR RULES ========\n\n- Never invent medication data.\n- Always rely on the tool output for the initial medication list.\n- Ask clear yes/no questions when verifying each medication.\n- Use patient-friendly language.\n- If the patient expresses uncertainty, clarify calmly and guide them.\n- Do NOT submit the reconciliation until all medications have been reviewed.\n- Do NOT call tools unless the step requires it.\n\n======== OUTPUT RULES ========\n\n- When calling a tool, output ONLY the tool invocation block.\n- All other communication must be natural-language conversation with the patient.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        208,
        0
      ],
      "id": "43d62884-f012-4bc4-9683-779bbb9c2f56",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        80,
        208
      ],
      "id": "c77c8a30-5f2e-4686-8d75-6d966dc63713",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "VtbiJs5HMh2j1vPr",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        224,
        208
      ],
      "id": "d5fe1583-aeb0-4ca5-8337-ff91e3f64423",
      "name": "Simple Memory",
      "disabled": true
    },
    {
      "parameters": {
        "toolDescription": "Fetches the patient's current medication list and returns structured JSON.\n\nThe API returns the following JSON shape:\n\n{\n  \"data\": {\n    \"medications\": [\n      {\n        \"_id\": \"...\",\n        \"active\": true,\n        \"name\": \"atorvastatin\",\n        \"dosage\": [\"10\"],            // array of dosage values\n        \"unit\": \"MG\",                // medication unit\n        \"frequency\": \"QD\",           // frequency shorthand\n        \"type\": \"oral\",              // route of administration\n        \"startDate\": \"2025-09-01\",\n        \"endDate\": null,\n        \"instruction\": \"WITH_MEAL\",  // optional\n        \"note\": \"text instructions\", // optional\n        \"medicationType\": [\"BG\"],    // optional groups\n        \"MajorMedicationType\": \"BP\", // optional high-level category\n        \"status\": \"TAKING\"           // e.g. TAKING / STOPPED\n      }\n    ],\n    \"patientId\": \"...\"\n  }\n}\n\nUse the returned JSON to answer patient questions in natural language.\n\nWhen responding:\n- Only use information from the JSON.\n- Explain medication names, dosage, unit, frequency, route, notes, and instructions.\n- Convert frequency abbreviations to patient-friendly language.\n- If dosage is an array (e.g., [\"10\"]), join into a readable string.\n- If medicationType or MajorMedicationType is present, you may use it to provide context (e.g., \"for blood pressure\").\n- If no medications are found, clearly say so.\n- Always explain in a supportive, easy-to-understand way, as if speaking to a patient.\n\nCommon frequency abbreviations:\n- QD  = once a day\n- BID = twice a day\n- TID = three times a day\n- QID = four times a day\n- ON  = every night\n- QHS = every night at bedtime\n- OM  = every morning\n- Q6H = every 6 hours\n- Q8H = every 8 hours\n- QOD = every other day\n- QWK = every week\n\nInterpretation rules:\n- \"TAKING\" or active: treat as current medications.\n- \"WITH_MEAL\": mention as “with meals”.\n- Combine medication info into clear statements, e.g.:\n  \"You take atorvastatin 10 mg once a day by mouth. You started on September 1st, 2025.\"\n\nYour output should always be natural language, not raw JSON.",
        "url": "https://benchmark.ihealth-eng.com/api/patients/682b5f1897997460ddec7dc7/medications/current",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        784,
        192
      ],
      "id": "de035259-dac2-4bef-9b6d-7ad5eff3cc07",
      "name": "medrec.get_current_meds",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ww7cuiRsIx5UF6CP",
          "name": "Header Auth"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "This HTTP Request node submits a completed medication reconciliation result for a patient. \nUse this tool when the agent has finished reviewing or confirming the patient’s current medications.\n\nRequest Method: POST\nRequest Content-Type: application/json\n\nExpected JSON body structure:\n\n{\n  \"reconciliation_id\": \"<string, optional: empty for new reconciliations>\",\n  \"patient_id\": \"<string: patient ID>\",\n  \"schema_version\": \"1.0.0\",\n  \"reconciliation_datetime\": \"<ISO datetime string when reconciliation was performed>\",\n  \"performed_by\": {\n    \"type\": \"AI Assistant\"\n    \"name\": AI model name,\n    \"role\": \"<role such as RN, MD, NP or AI>\"\n  },\n  \"medications\": [\n    {\n      \"medication_id\": \"<internal medication record ID>\",\n      \"uc_med_id\": \"<same as medication_id>\",\n      \"name\": \"<medication name>\",\n      \"type\": \"<route, e.g., oral>\",\n      \"dosage\": \"<dosage numeric value>\",\n      \"unit\": \"<unit, e.g., MG>\",\n      \"frequency\": \"<frequency shorthand: QD, BID, TID, QHS, etc.>\",\n      \"note\": \"<free text patient instruction>\",\n      \"start_date\": \"<YYYY-MM-DD>\",\n      \"status\": \"<optional: TAKING or STOPPED>\",\n      \"instruction\": \"<optional: e.g. WITH_MEAL>\",\n      \"MajorMedicationType\": \"<optional: BP, BG, etc.>\",\n      \"reconciliation_status\": \"confirmed | updated | removed\"\n    }\n  ],\n  \"global_adherence_summary\": {\n    \"score\": \"<high | medium | low>\"\n  },\n  \"session_payload\": {\n    \"autosaveNote\": \"<string: free text for draft status>\"\n  }\n}\n\nAgent guidance:\n- Only submit medications that have been confirmed, updated, or marked during reconciliation.\n- Do NOT invent medication fields; use only information available in the conversation or patient data.\n- Always include reconciliation_datetime as an ISO timestamp.\n- reconciliation_status should reflect the outcome per medication:\n    • confirmed — medication was verified as correct\n    • updated — medication details were corrected or modified\n    • removed — medication should be discontinued or deleted\n- Ensure all medication objects contain medication_id, name, dosage, unit, frequency, and reconciliation_status.\n- global_adherence_summary may include a simplified adherence assessment (\"high\", \"medium\", \"low\") based on conversation.\n- session_payload may include any draft notes to support chart documentation.\n\nUse this tool only after the reconciliation is complete and the agent is ready to commit the structured result.",
        "method": "POST",
        "url": "https://benchmark.ihealth-eng.com/api/medications/reconciliations",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        432,
        208
      ],
      "id": "3df53141-f91b-426a-b446-6fa87979884b",
      "name": "medrec.create_medication_reconsiliation",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ww7cuiRsIx5UF6CP",
          "name": "Header Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services-qa.walgreens.com/api/util/mweb5url",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        608,
        208
      ],
      "id": "8374b60d-7818-47f5-a140-fc40701a7e75",
      "name": "Walgreen_refill_obtain",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ww7cuiRsIx5UF6CP",
          "name": "Header Auth"
        }
      }
    }
  ],
  "origin": "n8n",
  "pinData": {},
  "repo": {
    "owner": "sage-ihealth",
    "name": "n8n-backup"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-13T18:05:31.541Z",
      "createdAt": "2025-11-13T18:05:31.541Z",
      "role": "workflow:owner",
      "workflowId": "NkJOG4K34YmLkO3z",
      "projectId": "IXgyKSoq6RADLFoU"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-19T22:54:59.000Z",
  "versionId": "c05895da-9129-4fef-8e21-8fc862ee6416"
}